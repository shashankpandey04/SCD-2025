{% extends "base.html" %}
{% block title %}Dashboard - AWS SCD 2025{% endblock %}
{% block content %}

<div id="bg-animated" class="relative overflow-hidden">
  <canvas id="animated-bg-canvas" class="absolute top-0 left-0 w-full h-full z-0 pointer-events-none"></canvas>

  <section id="dashboard" class="pt-32 pb-16 px-4 relative z-10">
    <div class="mx-auto max-w-6xl">
      
      <!-- Welcome Header -->
      <div class="glass-card p-6 sm:p-8 mb-8">
        <h1 class="text-3xl sm:text-4xl font-bold">Welcome back, {{ user.first_name }} ðŸ‘‹</h1>
        <p class="mt-2 text-neutral-300">Registration ID: <span class="text-violet-400 font-mono">{{ user.id }}</span></p>
        <p class="mt-1 text-neutral-400">{{ user.email }}</p>
      </div>

      <!-- Tabs Navigation -->
      <div class="flex flex-wrap justify-center sm:justify-start gap-2 mb-6">
        {% set tabs = [
          ('overview','Overview'),
          ('speakers','Speaker Proposals'),
          ('tickets','Tickets'),
          ('sponsor','Sponsorship'),
          ('profile','Profile')
        ] %}
        {% for id, label in tabs %}
        <button data-tab="{{ id }}" 
                class="tab-btn px-4 py-2 rounded-md bg-neutral-800/50 border border-neutral-700 text-sm text-neutral-300 hover:bg-violet-500/20 hover:text-violet-300 transition">
          {{ label }}
        </button>
        {% endfor %}
      </div>

      <!-- TAB CONTENTS -->
      <div id="tab-overview" class="tab-section active">
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <div class="glass-card text-center p-4">
            <div class="text-3xl font-bold text-violet-400">{{ dashboard_data.speakers|list|length }}</div>
            <div class="text-sm text-neutral-300 mt-1">Speaker Proposals</div>
          </div>
          <div class="glass-card text-center p-4">
            <div class="text-3xl font-bold text-amber-400">{{ dashboard_data.tickets|list|length }}</div>
            <div class="text-sm text-neutral-300 mt-1">Tickets</div>
          </div>
          <div class="glass-card text-center p-4">
            <div class="text-3xl font-bold text-green-400">{% if dashboard_data.sponsor %}1{% else %}0{% endif %}</div>
            <div class="text-sm text-neutral-300 mt-1">Sponsor Requests</div>
          </div>
        </div>
      </div>

      <!-- SPEAKERS TAB -->
      <div id="tab-speakers" class="tab-section hidden">
        <div class="glass-card p-6 sm:p-8 mb-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-2xl font-bold">Your Speaker Proposals</h2>
            <a href="/speakers" class="text-sm text-violet-400 hover:text-violet-300">Submit New â†’</a>
          </div>
          
          {% if dashboard_data.speakers|list|length > 0 %}
            <div class="space-y-4">
              {% for speaker in dashboard_data.speakers %}
              <div class="bg-neutral-900/60 border border-neutral-700 rounded-lg p-4 hover:border-violet-500/40 transition">
                <div class="flex items-start justify-between">
                  <div class="flex-1">
                    <h3 class="font-semibold text-lg text-neutral-100">{{ speaker.title }}</h3>
                    <p class="text-sm text-neutral-400 mt-1">Track: {{ speaker.track }}</p>
                    <p class="text-sm text-neutral-300 mt-2">{{ speaker.abstract[:150] }}{% if speaker.abstract|length > 150 %}...{% endif %}</p>
                  </div>
                  <div class="ml-4">
                    {% if speaker.status == 'pending' %}
                    <span class="status-chip bg-yellow-500/20 text-yellow-400 border-yellow-500/30">Pending</span>
                    {% elif speaker.status == 'accepted' %}
                    <span class="status-chip bg-green-500/20 text-green-400 border-green-500/30">Accepted</span>
                    {% elif speaker.status == 'rejected' %}
                    <span class="status-chip bg-red-500/20 text-red-400 border-red-500/30">Rejected</span>
                    {% endif %}
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="text-center py-8 text-neutral-400">You havenâ€™t submitted any speaker proposals yet.</div>
          {% endif %}
        </div>
      </div>

      <!-- TICKETS TAB -->
      <div id="tab-tickets" class="tab-section hidden">
        <div class="glass-card p-6 sm:p-8 mb-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-2xl font-bold">Your Tickets</h2>
            <a href="/waitlist" class="text-sm text-violet-400 hover:text-violet-300">Get Tickets â†’</a>
          </div>
          {% if dashboard_data.tickets %}
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            {% for ticket in dashboard_data.tickets %}
            <div class="rounded-lg border border-violet-500/30 bg-gradient-to-br from-violet-600/10 to-purple-600/10 p-4">
              <div class="flex justify-between mb-2">
                <span class="text-xs text-violet-300 font-semibold uppercase">Event Ticket</span>
                <span class="text-xs px-2 py-1 rounded-full {% if ticket.status == 'paid' %}bg-green-500/20 text-green-400{% else %}bg-yellow-500/20 text-yellow-400{% endif %}">
                  {{ ticket.status|capitalize }}
                </span>
              </div>
              <div class="font-bold text-lg">{{ user.first_name }} {{ user.last_name }}</div>
              <div class="text-sm text-neutral-300 mt-1">{{ ticket.ticket_type|default('General Admission') }}</div>
              <div class="border-t border-violet-500/20 mt-3 pt-2 text-xs text-neutral-400">
                <div class="flex justify-between">
                  <span>Order ID</span>
                  <span class="text-violet-400 font-mono">{{ ticket.order_id }}</span>
                </div>
                {% if ticket.amount %}
                <div class="flex justify-between mt-1">
                  <span>Amount</span>
                  <span class="text-green-400">â‚¹{{ ticket.amount }}</span>
                </div>
                {% endif %}
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
            <p class="text-center text-neutral-400 py-8">You don't have any tickets yet.</p>
          {% endif %}
        </div>
      </div>

      <!-- SPONSOR TAB -->
      <div id="tab-sponsor" class="tab-section hidden">
        <div class="glass-card p-6 sm:p-8 mb-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-2xl font-bold">Sponsorship</h2>
            {% if not dashboard_data.sponsor %}
            <a href="/sponsor#cfsponsors" class="text-sm text-violet-400 hover:text-violet-300">Submit Request â†’</a>
            {% endif %}
          </div>

          {% if dashboard_data.sponsor %}
          <div class="rounded-lg border border-blue-500/30 bg-blue-500/10 p-4">
            <h3 class="font-semibold text-lg">{{ dashboard_data.sponsor.company }}</h3>
            <p class="text-sm text-neutral-400">Contact: {{ dashboard_data.sponsor.contact }}</p>
            <p class="text-sm text-neutral-400">Email: {{ dashboard_data.sponsor.email }}</p>
            <p class="text-sm text-neutral-300 mt-2">Level: <span class="text-violet-400">{{ dashboard_data.sponsor.level }}</span></p>
          </div>
          {% else %}
          <div class="text-center py-8 text-neutral-400">You havenâ€™t submitted a sponsorship request yet.</div>
          {% endif %}
        </div>
      </div>

      <!-- PROFILE TAB -->
      <div id="tab-profile" class="tab-section hidden">
        <div class="glass-card p-6 sm:p-8">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-2xl font-bold">Your Profile</h2>
            <a href="/dashboard/profile" class="text-sm text-violet-400 hover:text-violet-300">Edit Profile â†’</a>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <span class="text-xs text-neutral-400">Full Name</span>
              <p class="text-neutral-200 mt-1">{{ user.first_name }} {{ user.last_name }}</p>
            </div>
            <div>
              <span class="text-xs text-neutral-400">Email</span>
              <p class="text-neutral-200 mt-1">{{ user.email }}</p>
            </div>
            <div>
              <span class="text-xs text-neutral-400">Phone</span>
              <p class="text-neutral-200 mt-1">{{ user.number }}</p>
            </div>
            <div>
              <span class="text-xs text-neutral-400">Company</span>
              <p class="text-neutral-200 mt-1">{{ user.company }}</p>
            </div>
            <div>
              <span class="text-xs text-neutral-400">Role</span>
              <p class="text-neutral-200 mt-1">{{ user.role }}</p>
            </div>
            <div>
              <span class="text-xs text-neutral-400">Registration ID</span>
              <p class="text-violet-400 font-mono text-sm mt-1">{{ user.id }}</p>
            </div>
          </div>
          <div class="mt-6 pt-6 border-t border-neutral-700">
            <a href="{{ url_for('auth.logout') }}" 
               class="inline-block px-6 py-2 bg-red-500/20 text-red-400 border border-red-500/30 rounded-md hover:bg-red-500/30 transition">
              Logout
            </a>
          </div>
        </div>
      </div>

    </div>
  </section>
</div>

<!-- Tab Switching JS -->
<script>
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const tab = btn.dataset.tab;
    document.querySelectorAll('.tab-section').forEach(sec => sec.classList.add('hidden'));
    document.querySelector(`#tab-${tab}`).classList.remove('hidden');
    
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('bg-violet-500/20', 'text-violet-300'));
    btn.classList.add('bg-violet-500/20', 'text-violet-300');
  });
});
</script>

{% endblock %}
