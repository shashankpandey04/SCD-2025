{% extends "base.html" %}
{% block title %}Speakers | AWS SCD Jalandhar 2025{% endblock %}
{% block content %}

<div id="bg-animated" class="relative overflow-hidden">
    <canvas id="animated-bg-canvas" class="absolute top-0 left-0 w-full h-full z-0 pointer-events-none"></canvas>

    <!-- Speaker Section -->
    <section id="speakers" class="pt-32 relative z-10">
        <div class="mx-auto max-w-3xl text-center">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-gradient">Our Speakers</h1>
            <p class="mt-4 text-neutral-300 text-base sm:text-lg">
                We're finalizing an exciting lineup of speakers from across the AWS, cloud, and AI ecosystem.
            </p>
            <p class="mt-2 text-neutral-400">
                Interested in speaking at our event? Submit your proposal below.
            </p>
        </div>
    </section>

    <!-- Call for Speakers -->
    <section id="cfs" class="pt-12 pb-20 relative z-10">
        <div class="mx-auto max-w-4xl">

            {% if current_user.is_authenticated %}
                {% if already_applied.status == 'pending' %}
                    <div class="glass-card p-8 reveal text-center">
                        <h2 class="text-3xl font-semibold">üé§ Proposal Submitted</h2>
                        <p class="mt-3 text-neutral-300">
                            Thank you for your interest! We‚Äôre reviewing your submission and will get back to you soon.
                            <br><br>
                            You‚Äôll be contacted at:
                            <span class="block mt-2 font-mono text-violet-400">{{ already_applied.email }}</span>
                        </p>
                        <p class="mt-3 text-sm text-neutral-500">
                            For questions, reach out to
                            <a href="mailto:scd@awslpu.in" class="text-violet-400 hover:text-violet-300">scd@awslpu.in</a>
                        </p>
                    </div>

                {% elif already_applied.status == 'accepted' %}
                    <div class="glass-card p-8 text-center reveal border border-violet-400/30 shadow-[0_0_30px_-10px_rgba(167,139,250,0.4)]">
                        <h2 class="text-3xl font-semibold text-violet-300">‚úÖ Proposal Accepted</h2>
                        <p class="mt-3 text-neutral-300">
                            Congratulations! Your session has been accepted for AWS SCD Jalandhar 2025.
                            We‚Äôll send further details to your registered email soon.
                        </p>
                    </div>

                {% elif already_applied.status == 'rejected' %}
                    <div class="glass-card p-8 text-center reveal border border-red-400/30">
                        <h2 class="text-3xl font-semibold text-red-300">‚ùå Proposal Not Selected</h2>
                        <p class="mt-3 text-neutral-300">
                            Thank you for submitting your proposal. Unfortunately, it wasn‚Äôt selected this time ‚Äî 
                            but we encourage you to apply for future events!
                        </p>
                    </div>

                {% else %}
                    <div class="glass-card p-8 reveal">
                        <h2 class="text-3xl font-semibold text-center">üì£ Call for Speakers</h2>
                        <p class="mt-3 text-neutral-300 text-center">
                            Share your expertise on AWS, GenAI, Cloud-native systems, or DevOps ‚Äî and inspire hundreds of developers.
                        </p>

                        <div id="message" class="mt-4 hidden p-4 rounded-md text-center"></div>

                        <form id="speakerForm" class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-neutral-300">Full Name</label>
                                <input required name="name" type="text"
                                    class="mt-1 w-full rounded-lg bg-neutral-800/60 border border-neutral-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-violet-400"
                                    placeholder="Your name"
                                    value="{{ current_user.first_name ~ ' ' ~ current_user.last_name }}">
                            </div>

                            <div>
                                <label class="text-sm text-neutral-300">Email</label>
                                <input required name="email" type="email"
                                    class="mt-1 w-full rounded-lg bg-neutral-800/60 border border-neutral-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-violet-400"
                                    placeholder="you@example.com"
                                    value="{{ current_user.email }}">
                            </div>

                            <div>
                                <label class="text-sm text-neutral-300">Talk Title</label>
                                <input required name="title" type="text"
                                    class="mt-1 w-full rounded-lg bg-neutral-800/60 border border-neutral-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-violet-400"
                                    placeholder="Title of your session">
                            </div>

                            <div>
                                <label class="text-sm text-neutral-300">Track</label>
                                <select required name="track"
                                    class="mt-1 w-full rounded-lg bg-neutral-800/60 border border-neutral-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-violet-400">
                                    <option value="" disabled selected>Select a track</option>
                                    <option>AI & Machine Learning</option>
                                    <option>Cloud Computing & Serverless</option>
                                    <option>Cybersecurity & Compliance</option>
                                    <option>Web3 & Blockchain</option>
                                    <option>DevOps & Infrastructure</option>
                                    <option>Data Analytics & Modern Databases</option>
                                </select>
                            </div>

                            <div class="sm:col-span-2">
                                <label class="text-sm text-neutral-300">Abstract</label>
                                <textarea required name="abstract" rows="4"
                                    class="mt-1 w-full rounded-lg bg-neutral-800/60 border border-neutral-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-violet-400"
                                    placeholder="Describe what attendees will learn..."></textarea>
                            </div>

                            <div>
                                <label class="text-sm text-neutral-300">Experience Level</label>
                                <select required name="level"
                                    class="mt-1 w-full rounded-lg bg-neutral-800/60 border border-neutral-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-violet-400">
                                    <option value="" disabled selected>Select level</option>
                                    <option>Beginner</option>
                                    <option>Intermediate</option>
                                    <option>Advanced</option>
                                </select>
                            </div>

                            <div>
                                <label class="text-sm text-neutral-300">Profile/Links (optional)</label>
                                <input name="link" type="text"
                                    class="mt-1 w-full rounded-lg bg-neutral-800/60 border border-neutral-700 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-violet-400"
                                    placeholder="LinkedIn, GitHub, website">
                            </div>

                            <div class="sm:col-span-2 flex justify-center">
                                <button type="submit" class="btn-primary rounded-md px-8 py-3 mt-4">
                                    Submit Proposal
                                </button>
                            </div>
                        </form>
                    </div>
                {% endif %}
            {% else %}
                <div class="glass-card p-8 text-center reveal">
                    <h2 class="text-3xl font-semibold">üîí Please Log In</h2>
                    <p class="mt-3 text-neutral-300">
                        You need to be logged in to submit a Call for Speakers proposal.
                    </p>
                    <a href="{{ url_for('auth.login') }}"
                       class="btn-primary mt-5 inline-block rounded-md px-6 py-3">
                        Log In to Continue
                    </a>
                </div>
            {% endif %}
        </div>
    </section>
</div>

<script>
const form = document.getElementById('speakerForm');
if (form) {
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const messageDiv = document.getElementById('message');

        try {
            const response = await fetch('/speakers', { method: 'POST', body: formData });
            const data = await response.json();

            if (response.ok) {
                messageDiv.className = 'mt-4 p-4 rounded-md text-center bg-green-500/20 text-green-300';
                messageDiv.textContent = data.message;
                form.innerHTML = `
                    <h2 class="text-2xl sm:text-3xl font-bold text-center">Thank you for your submission!</h2>
                    <p class="mt-2 text-neutral-300 text-center">
                        We‚Äôll review your proposal and get back to you soon.
                    </p>`;
            } else {
                messageDiv.className = 'mt-4 p-4 rounded-md text-center bg-red-500/20 text-red-300';
                messageDiv.textContent = data.error || 'An error occurred';
            }

            messageDiv.classList.remove('hidden');
        } catch {
            messageDiv.className = 'mt-4 p-4 rounded-md text-center bg-red-500/20 text-red-300';
            messageDiv.textContent = 'Failed to submit. Please try again.';
            messageDiv.classList.remove('hidden');
        }
    });
}
</script>

{% endblock %}
